---
title: "Labor Market Analysis part 1"
author: "y_bib"
format: pdf
editor: visual
---

Labor Market Canada

April 2025

Goal: get descriptive statistics of usual salary depending on gender, immigrant status, age

study differences between female and male extra hour work, part-time work, unemployment

based on open information provided by Statistica CA (Labor Market Survay)

```{r}
#| echo: false
#| message: false
#| warning: false
library(plyr)
library(dplyr)
library(ggplot2)
library(ggpmisc)
library(patchwork)
library(descr)
library(boot)



#reading date from Stat Ca
labour<-read.table(file='data/pub0325.txt',header=TRUE,sep="\t",stringsAsFactors = TRUE)

#indicating columns as factors
names<-as.vector(colnames(labour),mode="character")
names_factor<-setdiff(names,c("REC_NUM","FINALWT","PAIDOT","UNPAIDOT",
        "XTRAHRS","WKSAWAY","UHRSMAIN","AHRSMAIN",
        "UTOTHRS","ATOTHRS","HRSAWAY","TENURE","PREVTEN","HRLYEARN"))

labour[names_factor] <- lapply(labour[names_factor], as.factor)

labour$IMMIG<-revalue(labour$IMMIG, c("1" = "Immigrant,not more 10y", "2" = "Immigrant,more 10y", "3"="Non-immigrant"))
labour$GENDER <- revalue(labour$GENDER, c("1" = "Male", "2" = "Female"))
labour$FTPTMAIN<-revalue(labour$FTPTMAIN,c("1"="Full-time","2"="Part-time"))

```

```{r}
#| echo: false
#| message: false
#| warning: false

#means for extra hours depending on gender
tapply(labour$XTRAHRS, labour$GENDER, mean, na.rm = TRUE)
#full-time vs part-time and gender
table(labour$GENDER,labour$FTPTMAIN)
# reasons for part-time vs gender
tab<-xtabs(~ GENDER + WHYPT, data=labour )
tab
# Reasons for part time (WHYPT field)
# 0	Other reasons
# 1	Own illness or disability
# 2	Caring for children
# 3	Other personal or family responsibilities
# 4	Going to school
# 5	Personal preference
# 6	Business conditions or could not find full-time work, looked for full-time work in last month
# 7	Business conditions or could not find full-time work, did not look for full-time work in last month

#Conclusion : women stay away from work taking care of the children approx 10x then men


```

```{r}
#| echo: false
#| message: false
#| warning: false

#hour rate* usual hours=income  vs type of employment
tapply(0.01*labour$HRLYEARN, labour$PERMTEMP, mean, na.rm = TRUE)
tapply(0.01*labour$HRLYEARN, labour$PERMTEMP , median, na.rm = TRUE)
# Permanent or temporary job (field PERMTEMP)
# 1	Permanent
# 2	Temporary, seasonal job
# 3	Temporary, term or contract job
# 4	Temporary, casual or other temporary jobs


```

```{r}
#| echo: false
#| message: false
#| warning: false

#hour rate* usual hours=income  vs gender

tapply(0.01*labour$HRLYEARN*labour$UTOTHRS, labour$GENDER , mean, na.rm = TRUE)
tapply(0.01*labour$HRLYEARN*labour$UTOTHRS, labour$GENDER , median, na.rm = TRUE)
boxplot(HRLYEARN ~ GENDER ,data=labour, ylim=c(0,15000))
```

```{r}
#| echo: false
#| message: false
#| warning: false

#hour rate* usual hours=income  vs immigrant status

tapply(0.01*labour$HRLYEARN*labour$UTOTHRS, labour$IMMIG , mean, na.rm = TRUE)
tapply(0.01*labour$HRLYEARN*labour$UTOTHRS, labour$IMMIG , summary, na.rm = TRUE)
boxplot(0.01*HRLYEARN*UTOTHRS ~ IMMIG ,data=labour)
boxplot(HRLYEARN ~ IMMIG ,data=labour)
boxplot(UTOTHRS ~ IMMIG ,data=labour)
```

```{r}
#| echo: false
#| message: false
#| warning: false

tapply(labour$HRLYEARN, labour$AGE_12 , mean, na.rm = TRUE)
```

```{r}
#| echo: false
#| message: false
#| warning: false

ggplot(data=labour, aes(x=IMMIG,y=0.01*HRLYEARN*UTOTHRS))+
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75))+
  theme_minimal() +
  labs(x="Immigration status",y="Salary")
```

```{r}
#| echo: false
#| message: false
#| warning: false

# AVERAGE SALARY 
# EXTRA HOURS by GENDER and AGE
tmp <- with(labour, tapply(0.01 * HRLYEARN * UTOTHRS, AGE_12, mean, na.rm = TRUE))

# Convert names (factor levels) to numeric for x-axis
x_vals <- as.numeric(names(tmp))
y_vals <- as.numeric(tmp)

# Fit polynomial regression (degree 2)
model <- lm(y_vals ~ poly(x_vals, 2))

# Plot
plot(x_vals, y_vals, pch = 19, col = "darkorange", xlab = "AGE_12", ylab = "Mean Salary", main = "Salary vs Age")
lines(x_vals, predict(model), col = "blue", lwd = 2)
# 01	15 to 19 years
# 02	20 to 24 years
# 03	25 to 29 years
# 04	30 to 34 years
# 05	35 to 39 years
# 06	40 to 44 years
# 07	45 to 49 years
# 08	50 to 54 years
# 09	55 to 59 years
# 10	60 to 64 years
# 11	65 to 69 years
# 12	70 and over

```

```{r}
#| echo: false
#| message: false
#| warning: false

#hyst plot shows salary (based on usual hours and usual wages) by gender
labour %>%
ggplot( aes(x = AGE_12, y = 0.01*HRLYEARN*UTOTHRS,color=GENDER)) +
  stat_summary(fun = mean, geom = "col", fill = "white") +
  labs(x = "AGE", y = "Mean Salary")
```

```{r}
#| echo: false
#| message: false
#| warning: false

#hyst plot showing paid plus unpaid extra hours for Females and Males during the week of sampling
labour %>%
  ggplot( aes(x = AGE_12, y = 0.01*(UNPAIDOT+PAIDOT),color=GENDER)) +
  stat_summary(fun = mean, geom = "col",fill=NA) +
  labs(x = "AGE", y = "Paid overtime hours")
```

```{r}
#| echo: false
#| message: false
#| warning: false

#idea: income=hours*rate for different ages, non-linear dependence vs linear regression

#LINEAR REGRESSION for SALARY vs TENURE
model<-lm(formula = 0.01*HRLYEARN*UTOTHRS~TENURE,data=labour)
model
labour %>% ggplot(aes(x=TENURE,y=0.01*HRLYEARN*UTOTHRS))+
  geom_point(color="orange")+
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  theme_minimal()
```

```{r}
#| echo: false
#| message: false
#| warning: false

#LINEAR REGRESSION for SALARY vs AGE (groups AGE_12 are treated as numbers)
#SECOND ORDER POLINOMIAL REGRESSION for SALARY vs AGE (AGE_12 is treated as numbers)

model<-lm(formula = 0.01*HRLYEARN*UTOTHRS~as.numeric(AGE_12),data=labour)
model
lm(formula = 0.01*HRLYEARN*UTOTHRS~poly(as.numeric(AGE_12),2),data=labour)

p1<-labour %>% ggplot(aes(x=as.numeric(AGE_12),y=0.01*HRLYEARN*UTOTHRS))+
  geom_point(color="orange")+
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  geom_smooth(method = "lm",formula = y ~poly(x,2), se = FALSE, color = "blue") +
  theme_minimal()

p2<-labour %>% ggplot(aes(x=AGE_12,y=0.01*HRLYEARN*UTOTHRS))+
  geom_boxplot(fill="orange")+
  theme_minimal()

p1/p2
```

```{r}

#| echo: false
#| message: false
#| warning: false

# PART TIME vs GENDER

# reasons for part-time vs gender
tab<-xtabs(~ GENDER + WHYPT, data=labour )
tab
#Conclusion : women stay away from work taking care of the chieldren approx 10x then men

```

```{r}

#| echo: false
#| message: false
#| warning: false

df_tab <- as.data.frame(tab)

df_tab %>%
 # filter(WHYPT %in% c("2","3","6")) %>%
  ggplot( aes(x = WHYPT , y=Freq, color=GENDER)) +
  geom_point(size=3)+
  theme(legend.position="top")+
  labs(x = "Why part-time job", 
       caption = "0	- Other reasons
1 -	Own illness or disability
2	- Caring for children
3	- Other personal or family responsibilities
4	- Going to school
5	- Personal preference
6	- Business conditions or could not find full-time work, looked for full-time work in last month
7	- Business conditions or could not find full-time work, did not look for full-time work in last month
", 
       y = "Number")+
  theme(
    plot.caption = element_text(hjust = 0, size = 10)
  )
```

```{r}

#| echo: false
#| message: false
#| warning: false

# GENDER vs REASONS FOR LEAVING JOB
tab<-xtabs(~ GENDER + WHYLEFTN, data=labour )
tab
df_tab <- as.data.frame(tab)

df_tab %>%
  filter(WHYLEFTN %in% c("1","2","3","4","5")) %>%
  ggplot( aes(x = WHYLEFTN , y=Freq, color=GENDER)) +
  geom_point(size=3)+
  theme(legend.position="top")+
  labs(x = "Why left job in the last 12 months", 
       caption="
02	Job leavers, caring for children
03	Job leavers, pregnancy
04	Job leavers, personal or family responsibilities
05	Job leavers, going to school",
       y = "Number")+
theme(
  plot.caption = element_text(hjust = 0, size = 10)
)

# Conclusion: there are more males leaving work for school then females 
#
# part time going to school males 1664, females 2349
# left work because of the going to school males 810, females 738
# possible trend: males less likely work full or part-time during attending school
#compared to females
```

Bootstrap: non-weighted and weighted

```{r}
#| echo: false
#| message: false
#| warning: false

# Confidence intervals via non-weighted bootstrap  
# seed <- 1234
# set.seed(seed_value)

  
mean.function <- function(x, index) {
    d <- x[index]     # This first line will go in ever bootstrap function you make.
    return(mean(d,na.rm = TRUE))  
  }

BootHR<-boot(data = labour$HRLYEARN, statistic = mean.function, R=1000)
head(BootHR$t)
BootHR.graph <- data.frame(xbar=BootHR$t)

ggplot(BootHR.graph, aes(x=0.01*xbar)) +
  geom_histogram(color="darkblue", fill="lightblue") + 
  ggtitle('Estimated Sampling distribution of Means of Hour Rate (HRLYEARN)' )

# 0.95 confidence interval
quantile( BootHR$t, probs=c(.025, .975) ) 
boot.ci(BootHR, type = "perc", conf = 0.95)  
```
